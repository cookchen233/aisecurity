CREATE TABLE "ipc_event_fixers" ("ipc_event_id" bigint NOT NULL, "employee_id" bigint NOT NULL, PRIMARY KEY ("ipc_event_id", "employee_id"), CONSTRAINT "ipc_event_fixers_ipc_event_id" FOREIGN KEY ("ipc_event_id") REFERENCES "ipc_events" ("id") ON DELETE CASCADE, CONSTRAINT "ipc_event_fixers_employee_id" FOREIGN KEY ("employee_id") REFERENCES "employees" ("id") ON DELETE CASCADE);
CREATE TABLE "areas" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL DEFAULT '未命名区域', "description" character varying NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "areas_admins_area_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "areas_admins_area_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "devices" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "brand" bigint NULL DEFAULT 0, "model" bigint NULL DEFAULT 0, "name" character varying NULL DEFAULT '未命名设备', "sn" character varying NULL, "device_type" bigint NOT NULL DEFAULT 0, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "devices_admins_device_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "devices_admins_device_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "device_installations" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "alias_name" character varying NULL, "longitude" double precision NOT NULL, "latitude" double precision NOT NULL, "location_data" character varying NULL, "location" character varying NULL, "installer" character varying NULL, "install_time" timestamptz NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, "area_id" bigint NOT NULL, "device_id" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "device_installations_admins_device_installation_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "device_installations_admins_device_installation_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "device_installations_areas_device_installation_area" FOREIGN KEY ("area_id") REFERENCES "areas" ("id") ON DELETE NO ACTION, CONSTRAINT "device_installations_devices_device_installation_device" FOREIGN KEY ("device_id") REFERENCES "devices" ("id") ON DELETE NO ACTION);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" jsonb NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
ALTER TABLE "ipc_events" ALTER COLUMN "device_id" TYPE bigint, ALTER COLUMN "event_status" SET DEFAULT 0, ADD CONSTRAINT "ipc_events_devices_ipc_event_device" FOREIGN KEY ("device_id") REFERENCES "devices" ("id") ON DELETE NO ACTION;
CREATE TABLE "areas" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL DEFAULT '未命名区域', "description" character varying NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "areas_admins_area_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "areas_admins_area_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "devices" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "brand" bigint NULL DEFAULT 0, "model" bigint NULL DEFAULT 0, "name" character varying NULL DEFAULT '未命名设备', "sn" character varying NULL, "device_type" bigint NOT NULL DEFAULT 0, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "devices_admins_device_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "devices_admins_device_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "device_installations" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "alias_name" character varying NULL, "longitude" double precision NOT NULL, "latitude" double precision NOT NULL, "location_data" character varying NULL, "location" character varying NULL, "installer" character varying NULL, "install_time" timestamptz NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, "area_id" bigint NOT NULL, "device_id" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "device_installations_admins_device_installation_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "device_installations_admins_device_installation_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "device_installations_areas_device_installation_area" FOREIGN KEY ("area_id") REFERENCES "areas" ("id") ON DELETE NO ACTION, CONSTRAINT "device_installations_devices_device_installation_device" FOREIGN KEY ("device_id") REFERENCES "devices" ("id") ON DELETE NO ACTION);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" jsonb NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "videos" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "url" character varying NULL, "size" bigint NOT NULL DEFAULT 0, "duration" character varying NULL, "uploaded_at" timestamptz NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "videos_admins_video_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "videos_admins_video_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "ipc_events" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "event_time" timestamptz NOT NULL, "event_type" bigint NOT NULL DEFAULT 0, "event_status" bigint NOT NULL DEFAULT 0, "images" jsonb NULL, "labeled_images" jsonb NULL, "event_id" character varying NOT NULL, "description" character varying NULL, "raw_data" character varying NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, "device_id" bigint NOT NULL, "video_id" bigint NULL, PRIMARY KEY ("id"), CONSTRAINT "ipc_events_admins_ipc_event_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "ipc_events_admins_ipc_event_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "ipc_events_devices_ipc_event_device" FOREIGN KEY ("device_id") REFERENCES "devices" ("id") ON DELETE NO ACTION, CONSTRAINT "ipc_events_videos_ipc_event_video" FOREIGN KEY ("video_id") REFERENCES "videos" ("id") ON DELETE SET NULL);
CREATE TABLE "ipc_event_fixers" ("ipc_event_id" bigint NOT NULL, "employee_id" bigint NOT NULL, PRIMARY KEY ("ipc_event_id", "employee_id"), CONSTRAINT "ipc_event_fixers_ipc_event_id" FOREIGN KEY ("ipc_event_id") REFERENCES "ipc_events" ("id") ON DELETE CASCADE, CONSTRAINT "ipc_event_fixers_employee_id" FOREIGN KEY ("employee_id") REFERENCES "employees" ("id") ON DELETE CASCADE);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" jsonb NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "ipc_events" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "event_time" timestamptz NOT NULL, "event_type" bigint NOT NULL DEFAULT 0, "event_status" bigint NOT NULL DEFAULT 0, "images" jsonb NULL, "labeled_images" jsonb NULL, "event_id" character varying NOT NULL, "description" character varying NULL, "raw_data" character varying NULL, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, "device_id" bigint NOT NULL, "video_id" bigint NULL, PRIMARY KEY ("id"), CONSTRAINT "ipc_events_admins_ipc_event_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "ipc_events_admins_ipc_event_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "ipc_events_devices_ipc_event_device" FOREIGN KEY ("device_id") REFERENCES "devices" ("id") ON DELETE NO ACTION, CONSTRAINT "ipc_events_videos_ipc_event_video" FOREIGN KEY ("video_id") REFERENCES "videos" ("id") ON DELETE SET NULL);
ALTER TABLE "ipc_event_fixers" ADD CONSTRAINT "ipc_event_fixers_ipc_event_id" FOREIGN KEY ("ipc_event_id") REFERENCES "ipc_events" ("id") ON DELETE CASCADE;
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" jsonb NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" bigint NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" bigint NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" jsonb NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
CREATE TABLE "event_levels" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "deleted_at" timestamptz NULL, "updated_at" timestamptz NOT NULL, "name" character varying NULL, "event_types" jsonb NOT NULL, "description" character varying NULL, "is_report" boolean NULL DEFAULT false, "created_by" bigint NOT NULL, "updated_by" bigint NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "event_levels_admins_event_level_creator" FOREIGN KEY ("created_by") REFERENCES "admins" ("id") ON DELETE NO ACTION, CONSTRAINT "event_levels_admins_event_level_updater" FOREIGN KEY ("updated_by") REFERENCES "admins" ("id") ON DELETE NO ACTION);
